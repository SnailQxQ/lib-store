<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.turbine.tnd.dao.ResourceDao">

    <insert id="addResource" parameterType="Resource">
        INSERT INTO resource(fileName,size,type_id,location)
        VALUES(
                 #{fileName}
                ,#{size}
                ,#{type_id}
                ,#{location}

               )
    </insert>

    <!--table : resource_type -->
    <insert id="addReourceType">
        INSERT INTO resource_type(fileName,type_id) VALUES(#{fileName},#{type_id})
    </insert>

    <!--table : user_resource -->
    <insert id="addResourceUser">
        INSERT INTO user_resource(u_id,fileName,originalName) VALUES( #{u_id},#{fileName},#{originalName} )
    </insert>


    <select id="inquireType" resultType="ResourceType">
        SELECT id,type,state from filetype WHERE type = #{suffix}
    </select>

    <select id="inquireTypeById" resultType="ResourceType">
        SELECT id,type,state from filetype WHERE id = #{id}
    </select>
    
    <resultMap id="resource" type="Resource">
        <id column="id"></id>
        <result column="fileName" property="fileName"></result>
        <result column="size" property="size"></result>
        <result column="type_id" property="type_id"></result>
        <result column="location" property="location"></result>
        <association property="type"
                     javaType="ResourceType"
                     column="type_id"
                     select="inquireTypeById"/>
    </resultMap>

    <select id="inquireByName" resultMap="resource" >
        SELECT * FROM resource WHERE fileName = #{fileName}
    </select>
    
    

</mapper>